services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: api
    # Abrimos los puertos para que el ALB de AWS o tu host puedan entrar
    ports:
      - "80:80"  # Mapeamos el 80 externo al 8080 interno de tu binario
    restart: unless-stopped
    # Ya no necesitamos volúmenes compartidos para sockets de red
    sysctls:
      - net.core.somaxconn=65535         # Máximo nivel para absorber ráfagas
      - net.ipv4.tcp_tw_reuse=1          # Reutilización rápida de sockets
      - net.ipv4.ip_local_port_range=1024 65535
      - net.ipv4.tcp_max_syn_backlog=16384
    ulimits:
      nofile:
        soft: 100000
        hard: 100000
    deploy:
      resources:
        limits:
          memory: 512M 
          cpus: '1.0'

# El volumen tmpfs queda opcional si tu base de datos (SQLite/Postgres) 
# lo necesita para archivos temporales de alta velocidad.